const http = require('http');
const cluster = require('cluster');

const cpus = require('os').cpus();
const cpuLen = cpus.length;

if(cluster.isMaster){
	for(let i=0; i<cpuLen; i++)
	{
		cluster.fork();
		cluster.on('exit', (worker, code, signal)=>{
			console.log(worker.process.pid);
			cluster.fork();
		});
	}
}else{
	http.createServer((req, res)=>{
		console.log(process.pid + "CPU 실행");
		res.end(`${process.pid} 응답`);
	}).listen(3000);
	console.log(process.pid);
}